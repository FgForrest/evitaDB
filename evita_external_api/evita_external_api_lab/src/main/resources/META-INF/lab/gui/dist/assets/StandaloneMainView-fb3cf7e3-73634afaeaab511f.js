import{f as G,X as le,h as ue,Y as De,t as j,v as P,Z as F,$ as pe,a0 as de,o as b,e as S,w as e,d as c,a1 as ee,a2 as Z,G as D,B as V,C as y,E as ne,a3 as me,a4 as xe,a5 as ve,M as H,H as te,V as Se,_ as fe,N as O,a6 as Ee,a7 as Be,A as N,J as A,K as ae,L as z,I as Te,F as Le,i as J,r as Ie,a8 as be,a9 as ge,aa as _e,ab as ye,j as Ne,k as Re,l as $e,n as Ue,q as Ae,s as Ge,x as T,z as Q,y as Fe,O as se,ac as Pe,S as Me,T as We,P as Ke,Q as He,R as Qe,U as qe,W as je,ad as ce,ae as ze,af as Je,ag as Ye}from"./index-73634afaeaab511f.js";import{V as he,p as Xe,b as Ze,I as Oe,C as l,M as X,e as en,c as nn,_ as tn,a as an,W as on,d as rn}from"./ConnectionItemType-0566d1b1-73634afaeaab511f.js";import"./layout-6066fb81-73634afaeaab511f.js";var U=(u=>(u.Explorer="explorer",u))(U||{});const sn="/lab/logo/evitalab-logo-mini.png?raw=true",cn="/lab/documentation.svg",ln="/lab/discord.svg";var s=(u=>(u.Keymap="keymap",u.EvitaLabGithub="evitaLabGithub",u.DiscussEvitaLab="discussEvitaLab",u.ReportEvitaLabIssue="reportEvitaLabIssue",u.EvitaDBDocumentation="evitaDBDocumentation",u.EvitaDBGithub="evitaDBGithub",u.DiscussEvitaDB="discussEvitaDB",u.ReportEvitaDBIssue="reportEvitaDBIssue",u))(s||{});const un=G({__name:"ManageMenu",setup(u){const w=le(),m=ue(),p=De(),t=j(),{t:o}=P(),E=[{type:"subheader",title:o("panel.manage.manage.title")},{title:o(`panel.manage.manage.item.${s.Keymap}`),value:s.Keymap,command:F.System_Keymap,props:{prependIcon:"mdi-keyboard-outline"}},{type:"subheader",title:o("panel.manage.evitaLabHelp.title")},{title:o(`panel.manage.evitaLabHelp.item.${s.EvitaLabGithub}`),value:s.EvitaLabGithub,props:{prependIcon:"mdi-github"}},{title:o(`panel.manage.evitaLabHelp.item.${s.DiscussEvitaLab}`),value:s.DiscussEvitaLab,props:{prependIcon:"mdi-forum-outline"}},{title:o(`panel.manage.evitaLabHelp.item.${s.ReportEvitaLabIssue}`),value:s.ReportEvitaLabIssue,props:{prependIcon:"mdi-bug"}},{type:"subheader",title:o("panel.manage.evitaDBHelp.title")},{title:o(`panel.manage.evitaDBHelp.item.${s.EvitaDBDocumentation}`),value:s.EvitaDBDocumentation,props:{prependIcon:"mdi-book-open-variant"}},{title:o(`panel.manage.evitaDBHelp.item.${s.EvitaDBGithub}`),value:s.EvitaDBGithub,props:{prependIcon:"mdi-github"}},{title:o(`panel.manage.evitaDBHelp.item.${s.DiscussEvitaDB}`),value:s.DiscussEvitaDB,props:{prependIcon:"mdi-forum-outline"}},{title:o(`panel.manage.evitaDBHelp.item.${s.ReportEvitaDBIssue}`),value:s.ReportEvitaDBIssue,props:{prependIcon:"mdi-bug"}}];function g(){m.createTab(p.createNew())}function a(n){if(n.length>0)switch(n[0]){case s.Keymap:g();break;case s.EvitaLabGithub:window.open("https://github.com/lukashornych/evitalab","_blank");break;case s.DiscussEvitaLab:window.open("https://discord.gg/VsNBWxgmSw","_blank");break;case s.ReportEvitaLabIssue:window.open("https://github.com/lukashornych/evitalab/issues","_blank");break;case s.EvitaDBDocumentation:window.open("https://evitadb.io/documentation","_blank");break;case s.EvitaDBGithub:window.open("https://github.com/FgForrest/evitaDB","_blank");break;case s.DiscussEvitaDB:window.open("https://discord.gg/VsNBWxgmSw","_blank");break;case s.ReportEvitaDBIssue:window.open("https://github.com/FgForrest/evitaDB/issues","_blank");break;default:t.error(`Unknown manage option ${n[0]}`).then()}}return pe(()=>{w.bindGlobal(F.System_Keymap,g)}),de(()=>{w.unbindGlobal(F.System_Keymap)}),(n,k)=>(b(),S(Se,null,{activator:e(({props:r})=>[c(me,ne(r,{icon:"",variant:"text",class:"manage-button"}),{default:e(()=>[ee(n.$slots,"default",{},void 0,!0),c(Z,{activator:"parent"},{default:e(()=>[D(V(y(o)("panel.button.manage")),1)]),_:1})]),_:2},1040)]),default:e(()=>[c(te,{items:E,"onUpdate:selected":a},{title:e(({item:r})=>[c(xe,null,{default:e(()=>[D(V(r.title)+" ",1),r.command!=null?(b(),S(ve,{key:0,command:r.command},{default:e(()=>[D(V(r.title),1)]),_:2},1032,["command"])):H("",!0)]),_:2},1024)]),_:1})]),_:3}))}});const pn=fe(un,[["__scopeId","data-v-a9b52072"]]),dn={class:"lab-nav-links"},mn={href:"https://evitadb.io/documentation",target:"_blank"},vn=["alt"],fn={href:"https://discord.gg/VsNBWxgmSw",target:"_blank"},bn=["alt"],gn=G({__name:"WorkspacePanel",props:{panel:{}},emits:["update:panel"],setup(u,{emit:w}){const m=le(),{t:p}=P(),t=u,o=w,E=g();function g(){const n=[];return n.push(new O(U.Explorer,p(`panel.item.${U.Explorer}`),"mdi-connection",()=>{},F.System_Panels_ConnectionsExplorer)),n}function a(n){n.value?o("update:panel",n.id):o("update:panel",null)}return pe(()=>{m.bindGlobal(F.System_Panels_ConnectionsExplorer,()=>{t.panel===U.Explorer?o("update:panel",null):o("update:panel",U.Explorer)})}),de(()=>{m.unbindGlobal(F.System_Panels_ConnectionsExplorer)}),(n,k)=>(b(),S(he,{permanent:"",rail:"",class:"bg-primary-dark"},{prepend:e(()=>[c(pn,null,{default:e(()=>[c(Ee,{size:"30px"},{default:e(()=>[c(Be,{alt:"evitaLab Logo",width:"30px",height:"30px",src:sn})]),_:1})]),_:1})]),append:e(()=>[N("ul",dn,[N("li",null,[N("a",mn,[N("img",{src:cn,alt:y(p)("panel.link.evitaDBDocumentation.icon.alt")},null,8,vn),c(Z,{activator:"parent"},{default:e(()=>[D(V(y(p)("panel.link.evitaDBDocumentation.tooltip")),1)]),_:1})])]),N("li",null,[N("a",fn,[N("img",{src:ln,alt:y(p)("panel.link.discord.icon.alt")},null,8,bn),c(Z,{activator:"parent"},{default:e(()=>[D(V(y(p)("panel.link.discord.tooltip")),1)]),_:1})])])])]),default:e(()=>[c(te,{density:"compact",nav:"",selected:[n.panel],"onClick:select":a,class:"navigation-items"},{default:e(()=>[(b(!0),A(z,null,ae(y(E),r=>(b(),S(Te,{key:r.value,value:r.value},{default:e(()=>[c(Le,null,{default:e(()=>[D(V(r.prependIcon),1)]),_:2},1024),c(ve,{command:r.command},{default:e(()=>[D(V(r.title),1)]),_:2},1032,["command"])]),_:2},1032,["value"]))),128))]),_:1},8,["selected"])]),_:1}))}});const _n=fe(gn,[["__scopeId","data-v-d2d1dd7a"]]),yn=G({__name:"RemoveConnectionDialog",props:{modelValue:{type:Boolean},connection:{}},emits:["update:modelValue"],setup(u,{emit:w}){const m=J(),p=j(),{t}=P(),o=u,E=w;async function g(){try{return m.removeConnection(o.connection.id),await p.success(t("explorer.connection.remove.notification.connectionRemoved",{connectionName:o.connection.name})),!0}catch(a){return await p.error(t("explorer.connection.remove.notification.couldNotRemoveConnection",{connectionName:o.connection.name,reason:a.message})),!1}}return(a,n)=>{const k=Ie("I18nT");return b(),S(_e,{"model-value":a.modelValue,dangerous:"",changed:"","confirm-button-icon":"mdi-delete-outline",confirm:g,"onUpdate:modelValue":n[0]||(n[0]=r=>E("update:modelValue",r))},{activator:e(({props:r})=>[ee(a.$slots,"activator",be(ge(r)))]),title:e(()=>[c(k,{keypath:"explorer.connection.remove.title"},{connectionName:e(()=>[N("strong",null,V(a.connection.name),1)]),_:1})]),"prepend-form":e(()=>[D(V(y(t)("explorer.connection.remove.question")),1)]),"confirm-button-body":e(()=>[D(V(y(t)("common.button.remove")),1)]),_:3},8,["model-value"])}}}),hn={key:0},wn=G({__name:"ConnectionItem",props:{connection:{}},setup(u){const w=ye(),m=ue(),p=J(),t=Ne(),o=Re(),E=$e(),g=Ue(),a=Ae(),n=Ge(),k=j(),{t:r}=P(),v=u;Xe(v.connection);const B=T();Ze(B);const Y=Q(()=>{const i=[];return v.connection.preconfigured&&i.push(Oe.info(r("explorer.connection.flag.preconfigured"))),i}),R=T();Fe([()=>v.connection,B],async()=>R.value=await Ce(),{immediate:!0});const d=Q(()=>R.value==null?[]:Array.from(R.value.values())),f=T(),h=T(!1),$=T(!1),I=T(!1);let oe=!1;async function re(){oe||(h.value=!0,oe=await ie().then(i=>i?q():!1),h.value=!1)}async function we(){h.value=!0,await ie().then(i=>i?q():!1),h.value=!1}async function ie(){try{return B.value=await p.getServerStatus(v.connection),!0}catch(i){return await k.error(r("explorer.connection.notification.couldNotLoadServerStatus",{connectionName:v.connection.name,reason:i.message})),!1}}async function q(){try{return f.value=(await p.getCatalogs(v.connection,!0)).sort((i,_)=>i.name.localeCompare(_.name)),!0}catch(i){return await k.error(r("explorer.connection.notification.couldNotLoadCatalogs",{connectionName:v.connection.name,reason:i.message})),!1}}async function ke(){try{await p.closeAllSessions(v.connection),await k.success(r("explorer.connection.notification.closedAllSessions",{connectionName:v.connection.name}))}catch(i){await k.error(r("explorer.connection.notification.couldNotCloseSessions",{connectionName:v.connection.name,reason:i.message}))}}function Ve(i){if(R.value==null)return;const _=R.value.get(i);_ instanceof O&&_.execute()}async function Ce(){const i=B.value!=null&&B.value.apiEnabled(se.GraphQL),_=B.value!=null&&B.value.apiEnabled(se.Observability),x=!v.connection.preconfigured,M=!w.readOnly,W=B.value!=null,K=W&&!B.value.readOnly,C=new Map;return C.set(l.Server,L(l.Server,Me.icon(),()=>m.createTab(o.createNew(v.connection)),W)),C.set(l.Tasks,L(l.Tasks,We.icon(),()=>{m.createTab(E.createNew(v.connection))},K)),C.set(l.TrafficRecordings,L(l.TrafficRecordings,Ke.icon(),()=>{m.createTab(a.createNew(v.connection))},K)),C.set(l.JfrRecordings,L(l.JfrRecordings,He.icon(),()=>{m.createTab(g.createNew(v.connection))},K&&_)),C.set(l.GraphQLSystemAPIConsole,L(l.GraphQLSystemAPIConsole,qe.icon(),()=>m.createTab(t.createNew(v.connection,"system",Qe.System)),i)),C.set(l.ManageSubheader,new X(r("explorer.connection.subheader.manage"))),C.set(l.Refresh,L(l.Refresh,"mdi-refresh",async()=>await we())),C.set(l.CloseAllSessions,L(l.CloseAllSessions,"mdi-lan-disconnect",()=>ke(),W)),C.set(l.ModifySubheader,new X(r("explorer.connection.subheader.modify"))),C.set(l.Remove,L(l.Remove,"mdi-delete-outline",()=>$.value=!0,x&&M)),C.set(l.CatalogsSubheader,new X(r("explorer.connection.subheader.catalogs"))),C.set(l.CreateCatalog,L(l.CreateCatalog,"mdi-plus",()=>I.value=!0,K)),C.set(l.CatalogBackups,L(l.CatalogBackups,je.icon(),()=>{m.createTab(n.createNew(v.connection))},K)),C}function L(i,_,x,M=!0){return new O(i,r(`explorer.connection.actions.${i}`),_,x,void 0,!M)}return(i,_)=>(b(),A("div",null,[c(Pe,{value:i.connection.name},{activator:e(({isOpen:x,props:M})=>[c(en,ne(M,{openable:"","is-open":x,"prepend-icon":"mdi-power-plug-outline",loading:h.value,flags:Y.value,actions:d.value,onClick:_[0]||(_[0]=W=>re()),"onClick:actionMenu":_[1]||(_[1]=W=>re()),"onClick:action":Ve}),{default:e(()=>[D(V(i.connection.name),1)]),_:2},1040,["is-open","loading","flags","actions"])]),default:e(()=>[f.value!==void 0?(b(),A("div",hn,[f.value.size>0?(b(!0),A(z,{key:0},ae(f.value,x=>(b(),S(nn,{key:x.name,catalog:x,onChange:q},null,8,["catalog"]))),128)):(b(),S(tn,{key:1}))])):H("",!0),$.value?(b(),S(yn,{key:1,modelValue:$.value,"onUpdate:modelValue":_[2]||(_[2]=x=>$.value=x),connection:i.connection},null,8,["modelValue","connection"])):H("",!0),I.value?(b(),S(an,{key:2,modelValue:I.value,"onUpdate:modelValue":_[3]||(_[3]=x=>I.value=x),connection:i.connection,onCreate:q},null,8,["modelValue","connection"])):H("",!0)]),_:1},8,["value"])]))}}),kn=G({__name:"ConnectToServerDialog",props:{modelValue:{type:Boolean},connection:{default:void 0}},emits:["update:modelValue"],setup(u,{emit:w}){const m=J(),p=j(),{t}=P(),o=w,E=[d=>d?!0:t("explorer.connection.connect.form.connectionName.validations.required"),d=>m.isConnectionExists(d)?t("explorer.connection.connect.form.connectionName.validations.duplicate"):!0],g=[d=>d?!0:t("explorer.connection.connect.form.serverUrl.validations.required"),d=>{try{return new URL(d),!0}catch{return t("explorer.connection.connect.form.serverUrl.validations.invalidUrl")}},async d=>{const f=await B(d);return f==null?(k.value=1,!0):(k.value=2,f)}],a=T(""),n=T(""),k=T(0),r=Q(()=>a.value!=null&&a.value.length>0&&n.value!=null&&n.value.length>0),v=Q(()=>{switch(k.value){case 0:return"";case 1:return"mdi-check-circle-outline";case 2:return"mdi-close-circle-outline"}});async function B(d){var f,h;try{const $=d.endsWith("/")?d:d+"/",I=await ze.post(`${$}io.evitadb.externalApi.grpc.generated.EvitaManagementService/ServerStatus`,{headers:{"Content-Type":"application/json",Accept:"application/json"},body:"{}"}).json();return I.readiness!=="API_READY"?t("explorer.connection.connect.form.serverUrl.validations.notReady"):((f=I.api.lab)==null?void 0:f.enabled)!==!0?t("explorer.connection.connect.form.serverUrl.validations.labApiMissing"):((h=I.api.gRPC)==null?void 0:h.enabled)!==!0?t("explorer.connection.connect.form.serverUrl.validations.grpcApiMissing"):void 0}catch{return t("explorer.connection.connect.form.serverUrl.validations.unreachable")}}function Y(){a.value="",n.value="",k.value=0}async function R(){try{return m.addConnection(Je.user(void 0,a.value,n.value)),await p.success(t("explorer.connection.connect.notification.connectionAdded",{connectionName:a.value})),!0}catch(d){return await p.error(t("explorer.connection.connect.notification.couldNotAddConnection",{reason:d.message})),!1}}return(d,f)=>(b(),S(_e,{"model-value":d.modelValue,changed:r.value,"confirm-button-icon":"mdi-power-plug-outline",confirm:R,reset:Y,"onUpdate:modelValue":f[2]||(f[2]=h=>o("update:modelValue",h))},{activator:e(({props:h})=>[ee(d.$slots,"activator",be(ge({props:h})))]),title:e(()=>[D(V(y(t)("explorer.connection.connect.title")),1)]),default:e(()=>[c(ce,{modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=h=>a.value=h),label:y(t)("explorer.connection.connect.form.connectionName.label"),placeholder:"evitaDB",rules:E,required:""},null,8,["modelValue","label"]),c(ce,{modelValue:n.value,"onUpdate:modelValue":f[1]||(f[1]=h=>n.value=h),label:y(t)("explorer.connection.connect.form.serverUrl.label"),placeholder:"https://{evitadb-server}:5555",hint:y(t)("explorer.connection.connect.form.serverUrl.hint"),required:"",rules:g,"append-inner-icon":v.value},null,8,["modelValue","label","hint","append-inner-icon"])]),"confirm-button-body":e(()=>[D(V(y(t)("explorer.connection.connect.button.connect")),1)]),_:3},8,["model-value","changed"]))}}),Vn={key:0,class:"pa-2"},Cn=G({__name:"ConnectionExplorerPanel",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(u,{emit:w}){const m=ye(),p=J(),{t}=P(),o=T(!1),E=Q(()=>p.getConnections().sort((g,a)=>g.preconfigured&&!a.preconfigured?-1:a.preconfigured&&!g.preconfigured?1:g.name.localeCompare(a.name)));return(g,a)=>(b(),S(he,{permanent:"","model-value":g.modelValue,width:325,"onUpdate:modelValue":a[2]||(a[2]=n=>g.$emit("update:modelValue",n)),class:"bg-primary"},{append:e(()=>[y(m).readOnly?H("",!0):(b(),A("div",Vn,[c(kn,{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=n=>o.value=n)},{activator:e(({props:n})=>[c(me,ne({"prepend-icon":"mdi-power-plug-outline",block:"",variant:"outlined"},n,{onClick:a[0]||(a[0]=k=>o.value=!0)}),{default:e(()=>[D(V(y(t)("explorer.button.connect")),1)]),_:2},1040)]),_:1},8,["modelValue"])]))]),default:e(()=>[c(te,{density:"compact",nav:""},{default:e(()=>[c(Ye,{class:"text-gray-light text-sm-body-2 font-weight-medium"},{default:e(()=>[D(V(y(t)("explorer.title")),1)]),_:1}),(b(!0),A(z,null,ae(E.value,n=>(b(),S(wn,{key:n.name,connection:n},null,8,["connection"]))),128))]),_:1})]),_:1},8,["model-value"]))}}),En=G({__name:"StandaloneMainView",setup(u){const w=T(U.Explorer);return(m,p)=>(b(),A(z,null,[c(on),c(_n,{panel:w.value,"onUpdate:panel":p[0]||(p[0]=t=>w.value=t)},null,8,["panel"]),c(Cn,{"model-value":w.value===y(U).Explorer},null,8,["model-value"]),c(rn)],64))}});export{En as default};
